(function(){tinymce.create("org.olat.modules.edusharing.ui",{init:function(j,b){var f,g;var h;function k(){if(f){return f}var p=o_getMainWin();if(p){f=jQuery(document).ooTranslator().getTranslator(p.o_info.locale,"org.olat.modules.edusharing.ui")}else{f={translate:function(q){return q}}}return f}function e(){if(g){return g}var p=o_getMainWin();if(p){g=jQuery(document).ooTranslator().getTranslator(p.o_info.locale,"org.olat.core")}else{g={translate:function(q){return q}}}return g}function l(p){switch(p){case"left":var q="display: block; float: left; margin: 5px 5px 5px 0;";break;case"right":var q="display: block; float: right; margin: 5px 0 5px 5px;";break;case"inline":var q="display: inline-block; margin: 0 5px;";break;case"none":default:var q="display: block; float: none; margin: 5px 0;";break}return q}function n(p){if(1!=p.nodeType){return false}if(!p.dataset.es_identifier){return false}return true}function o(){function p(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return p()+p()+p()+p()+p()+p()+p()+p()}function d(r){var q=j.getParam("contextPath");var p=q+"/edusharing/preview",p=p.concat("?objectUrl="+r.object_url);p=p.concat("&version="+r.window_version);return p}function m(q){var p=q!=null&&q.mimetype!==null?q.mimetype.substr(0,6).toLowerCase():null;if(q.mediatype=="tool_object"||p=="audio/"||p=="video/"||p=="image/"||q.repotype=="YOUTUBE"){return true}return false}function i(q){if(typeof q.target.params=="undefined"){console.warn("edu-sharing selection returns nothing.");return}if(typeof q.target.params.mimetype=="undefined"){return}var r=q.target.params;var p=j.selection.getNode();node=null;if(m(r)){node=document.createElement("img");node=p.appendChild(node);node.setAttribute("src",d(r))}else{node=document.createElement("a");node=p.appendChild(node);node.innerHTML=r.title}node.dataset.es_identifier=o();node.dataset.es_objecturl=r.object_url;node.dataset.es_version=r.window_version;node.dataset.es_version_current=r.window_version;if(r.es_mimetype!==null){node.dataset.es_mimetype=r.mimetype}if(r.mediatype!==null){node.dataset.es_mediatype=r.mediatype}if(r.window_width!==null){node.dataset.es_width=r.window_width}if(r.window_height!==null){node.dataset.es_height=r.window_height}node.dataset.es_first_edit=true;r.esFloat="left";c(node,r);j.selection.setCursorLocation(node);j.execCommand("edusharing_edit_dialog")}function a(q){console.log(q.data);var r=q.data;var p=j.selection.getNode();c(p,r);if(r.window_versionshow=="latest"){p.dataset.es_version=0}else{p.dataset.es_version=p.dataset.es_version_current}p.dataset.es_float=r.esFloat;j.execCommand("mceRepaint")}function c(r,s){r.setAttribute("class","edusharing");r.setAttribute("alt",s.title);r.setAttribute("title",s.title);var q=s.window_width;if(q==0){q=""}r.setAttribute("width",q);var p=s.window_height;if(p==0){p=""}r.setAttribute("height",p);r.setAttribute("style",l(s.esFloat))}j.addButton("olatedusharing",{title:"edu-sharing",image:b+"/img/edusharing.png",cmd:"edusharing_button",onPostRender:function(){var p=this;j.on("NodeChange",function(r){var q=n(j.selection.getNode());p.active(q)})}});j.addCommand("edusharing_button",function(r,q){var p=j.selection.getNode();if(p){if(n(p)){j.execCommand("edusharing_edit_dialog",r,q)}else{j.execCommand("edusharing_insert_dialog",r,q)}}});j.addCommand("edusharing_insert_dialog",function(){var p={url:j.getParam("contextPath")+"/edusharing/search",width:document.documentElement.clientWidth*0.8,height:document.documentElement.clientHeight*0.8,inline:1,maximizable:true,onClose:i};j.windowManager.open(p)});j.addCommand("edusharing_edit_dialog",function(s,r){var q=j.selection.getNode();if(!n(q)){return false}var u={window_width:q.getAttribute("width"),window_height:q.getAttribute("height"),title:q.getAttribute("title"),esFloat:q.dataset.es_float,window_versionshow:q.dataset.es_version==0?"latest":"current",mimetype:q.dataset.es_mimetype};var p=q.dataset.es_first_edit==="true"?false:true;q.dataset.es_first_edit=false;var t=!m(u);j.windowManager.open({title:k().translate("tiny.config.dialog.title"),body:[{type:"form",items:[{name:"title",type:"textbox",label:k().translate("tiny.config.title"),value:u.title},{name:"window_versionshow",type:"listbox",label:p?null:k().translate("tiny.config.version"),values:[{text:k().translate("tiny.config.version.latest"),value:"latest"},{text:k().translate("tiny.config.version.current"),value:"current"}],value:u.window_versionshow,hidden:p},{name:"esFloat",type:"listbox",label:k().translate("tiny.config.float"),values:[{text:k().translate("tiny.config.float.left"),value:"left"},{text:k().translate("tiny.config.float.right"),value:"right"},{text:k().translate("tiny.config.float.inline"),value:"inline"},{text:k().translate("tiny.config.float.none"),value:"none"}],value:u.esFloat},{type:"container",label:t?null:k().translate("tiny.config.size"),layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"window_width",type:"textbox",value:u.window_width,maxLength:4,size:4},{type:"label",text:"x"},{name:"window_height",type:"textbox",value:u.window_height,maxLength:4,size:4}],hidden:t}]}],onSubmit:a},u)})},getInfo:function(){return{longname:"OpenOLAT edu-sharing",author:"uhensler, frentix GmbH",authorurl:"http://www.frentix.com",infourl:"http://www.frentix.com",version:"1.0.0"}}});tinymce.PluginManager.add("olatedusharing",org.olat.modules.edusharing.ui)})();